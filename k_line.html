<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" src="js/svg.js" ></script>
    <script type="text/javascript" src="js/stock.js" ></script>
</head>
<body onresize="init()" onload="init()" >
<button id="btn_draw" onclick="ready_draw()" > 画 线 </button>
<svg id="svg" version="1.1"   xmlns="http://www.w3.org/2000/svg" style="border:1px solid black;"  onmousedown="mouse_down(evt)" onmouseup="mouse_up(evt)" onmousemove="mouse_move(evt)"  ></svg>
</body>
<script type="text/javascript" >
    var stock_data_json = '{"type": "day", "gid": "sz002684", "start_time": "2016/6/1", "end_time": "2016/10/1" , "items": [{"item_start_time": "2016/6/1 0:00:00", "item_end_time": "2016/6/1 0:00:00", "item_start_price": "29", "item_end_price": "29.2" , "item_highest_price": "29.97" , "item_lowest_price": "28.72" , "item_deal": "133430" , "item_volumn": "39198.19" , "item_change": "6.48" },{"item_start_time": "2016/6/2 0:00:00", "item_end_time": "2016/6/2 0:00:00", "item_start_price": "29.14", "item_end_price": "29.48" , "item_highest_price": "29.7" , "item_lowest_price": "28.85" , "item_deal": "102743" , "item_volumn": "30137.11" , "item_change": "4.99" },{"item_start_time": "2016/6/3 0:00:00", "item_end_time": "2016/6/3 0:00:00", "item_start_price": "29.54", "item_end_price": "30" , "item_highest_price": "30.29" , "item_lowest_price": "29" , "item_deal": "128560" , "item_volumn": "38096.45" , "item_change": "6.24" },{"item_start_time": "2016/6/6 0:00:00", "item_end_time": "2016/6/6 0:00:00", "item_start_price": "30.03", "item_end_price": "31.05" , "item_highest_price": "31.5" , "item_lowest_price": "30.03" , "item_deal": "172537" , "item_volumn": "53209.04" , "item_change": "8.38" },{"item_start_time": "2016/6/7 0:00:00", "item_end_time": "2016/6/7 0:00:00", "item_start_price": "30.77", "item_end_price": "34.16" , "item_highest_price": "34.16" , "item_lowest_price": "30.77" , "item_deal": "302109" , "item_volumn": "100725.25" , "item_change": "14.67" },{"item_start_time": "2016/6/8 0:00:00", "item_end_time": "2016/6/8 0:00:00", "item_start_price": "34.22", "item_end_price": "34.66" , "item_highest_price": "35.45" , "item_lowest_price": "33.2" , "item_deal": "314323" , "item_volumn": "107568.23" , "item_change": "15.27" },{"item_start_time": "2016/6/13 0:00:00", "item_end_time": "2016/6/13 0:00:00", "item_start_price": "34.03", "item_end_price": "31.19" , "item_highest_price": "34.2" , "item_lowest_price": "31.19" , "item_deal": "182042" , "item_volumn": "59871.25" , "item_change": "8.84" },{"item_start_time": "2016/6/14 0:00:00", "item_end_time": "2016/6/14 0:00:00", "item_start_price": "30.37", "item_end_price": "31.01" , "item_highest_price": "31.28" , "item_lowest_price": "29.35" , "item_deal": "125728" , "item_volumn": "38329.32" , "item_change": "6.11" },{"item_start_time": "2016/6/15 0:00:00", "item_end_time": "2016/6/15 0:00:00", "item_start_price": "30.7", "item_end_price": "33.85" , "item_highest_price": "34.11" , "item_lowest_price": "30.46" , "item_deal": "196023" , "item_volumn": "65368.04" , "item_change": "9.52" },{"item_start_time": "2016/6/16 0:00:00", "item_end_time": "2016/6/16 0:00:00", "item_start_price": "33.86", "item_end_price": "33.07" , "item_highest_price": "35.35" , "item_lowest_price": "32.5" , "item_deal": "225398" , "item_volumn": "76944.94" , "item_change": "10.95" },{"item_start_time": "2016/6/17 0:00:00", "item_end_time": "2016/6/17 0:00:00", "item_start_price": "33.06", "item_end_price": "33" , "item_highest_price": "34.44" , "item_lowest_price": "32.52" , "item_deal": "119257" , "item_volumn": "39648.27" , "item_change": "5.79" },{"item_start_time": "2016/6/20 0:00:00", "item_end_time": "2016/6/20 0:00:00", "item_start_price": "33.51", "item_end_price": "34.98" , "item_highest_price": "34.98" , "item_lowest_price": "33.01" , "item_deal": "150836" , "item_volumn": "51402.5" , "item_change": "7.33" },{"item_start_time": "2016/6/21 0:00:00", "item_end_time": "2016/6/21 0:00:00", "item_start_price": "35.05", "item_end_price": "33" , "item_highest_price": "35.88" , "item_lowest_price": "32.51" , "item_deal": "161595" , "item_volumn": "55170.89" , "item_change": "7.85" },{"item_start_time": "2016/6/22 0:00:00", "item_end_time": "2016/6/22 0:00:00", "item_start_price": "32.7", "item_end_price": "33.57" , "item_highest_price": "33.57" , "item_lowest_price": "32" , "item_deal": "82352" , "item_volumn": "27091.11" , "item_change": "4" },{"item_start_time": "2016/6/23 0:00:00", "item_end_time": "2016/6/23 0:00:00", "item_start_price": "33.42", "item_end_price": "33.25" , "item_highest_price": "34.18" , "item_lowest_price": "32.77" , "item_deal": "91443" , "item_volumn": "30572.83" , "item_change": "4.44" },{"item_start_time": "2016/6/24 0:00:00", "item_end_time": "2016/6/24 0:00:00", "item_start_price": "33.25", "item_end_price": "32.33" , "item_highest_price": "33.7" , "item_lowest_price": "30.14" , "item_deal": "99263" , "item_volumn": "32061.26" , "item_change": "4.82" },{"item_start_time": "2016/6/27 0:00:00", "item_end_time": "2016/6/27 0:00:00", "item_start_price": "31.85", "item_end_price": "32.99" , "item_highest_price": "33.2" , "item_lowest_price": "31.78" , "item_deal": "73425" , "item_volumn": "23898.69" , "item_change": "3.57" },{"item_start_time": "2016/6/28 0:00:00", "item_end_time": "2016/6/28 0:00:00", "item_start_price": "32.99", "item_end_price": "33.55" , "item_highest_price": "34.02" , "item_lowest_price": "32.9" , "item_deal": "109871" , "item_volumn": "36869.63" , "item_change": "5.34" },{"item_start_time": "2016/6/29 0:00:00", "item_end_time": "2016/6/29 0:00:00", "item_start_price": "33.7", "item_end_price": "33.21" , "item_highest_price": "34.34" , "item_lowest_price": "33.16" , "item_deal": "90463" , "item_volumn": "30514.48" , "item_change": "4.39" },{"item_start_time": "2016/6/30 0:00:00", "item_end_time": "2016/6/30 0:00:00", "item_start_price": "33.12", "item_end_price": "32.48" , "item_highest_price": "33.5" , "item_lowest_price": "32.35" , "item_deal": "63787" , "item_volumn": "20944.71" , "item_change": "3.1" },{"item_start_time": "2016/7/1 0:00:00", "item_end_time": "2016/7/1 0:00:00", "item_start_price": "32.72", "item_end_price": "31.67" , "item_highest_price": "32.72" , "item_lowest_price": "31.3" , "item_deal": "90206" , "item_volumn": "28657.79" , "item_change": "4.38" },{"item_start_time": "2016/7/4 0:00:00", "item_end_time": "2016/7/4 0:00:00", "item_start_price": "31.5", "item_end_price": "31.81" , "item_highest_price": "32.33" , "item_lowest_price": "31" , "item_deal": "58191" , "item_volumn": "18555.35" , "item_change": "2.83" },{"item_start_time": "2016/7/5 0:00:00", "item_end_time": "2016/7/5 0:00:00", "item_start_price": "31.9", "item_end_price": "32.25" , "item_highest_price": "32.75" , "item_lowest_price": "31.7" , "item_deal": "64933" , "item_volumn": "20880.09" , "item_change": "3.15" },{"item_start_time": "2016/7/6 0:00:00", "item_end_time": "2016/7/6 0:00:00", "item_start_price": "32.24", "item_end_price": "32.31" , "item_highest_price": "32.75" , "item_lowest_price": "31.77" , "item_deal": "63892" , "item_volumn": "20729.34" , "item_change": "3.1" },{"item_start_time": "2016/7/7 0:00:00", "item_end_time": "2016/7/7 0:00:00", "item_start_price": "32.31", "item_end_price": "32.99" , "item_highest_price": "33" , "item_lowest_price": "31.88" , "item_deal": "86491" , "item_volumn": "28103.85" , "item_change": "4.2" },{"item_start_time": "2016/7/8 0:00:00", "item_end_time": "2016/7/8 0:00:00", "item_start_price": "32.99", "item_end_price": "32.64" , "item_highest_price": "33.67" , "item_lowest_price": "32.55" , "item_deal": "93242" , "item_volumn": "30952.75" , "item_change": "4.53" },{"item_start_time": "2016/7/11 0:00:00", "item_end_time": "2016/7/11 0:00:00", "item_start_price": "32.14", "item_end_price": "31.3" , "item_highest_price": "32.4" , "item_lowest_price": "31.3" , "item_deal": "82679" , "item_volumn": "26258.51" , "item_change": "4.02" },{"item_start_time": "2016/7/12 0:00:00", "item_end_time": "2016/7/12 0:00:00", "item_start_price": "30.99", "item_end_price": "31.33" , "item_highest_price": "31.8" , "item_lowest_price": "30.5" , "item_deal": "53514" , "item_volumn": "16592.6" , "item_change": "2.6" },{"item_start_time": "2016/7/13 0:00:00", "item_end_time": "2016/7/13 0:00:00", "item_start_price": "31.33", "item_end_price": "31.22" , "item_highest_price": "31.59" , "item_lowest_price": "31.02" , "item_deal": "38392" , "item_volumn": "11988.93" , "item_change": "1.86" },{"item_start_time": "2016/7/14 0:00:00", "item_end_time": "2016/7/14 0:00:00", "item_start_price": "31.35", "item_end_price": "31.65" , "item_highest_price": "32.1" , "item_lowest_price": "31.23" , "item_deal": "37824" , "item_volumn": "11972.25" , "item_change": "1.84" },{"item_start_time": "2016/7/15 0:00:00", "item_end_time": "2016/7/15 0:00:00", "item_start_price": "31.75", "item_end_price": "31.6" , "item_highest_price": "31.87" , "item_lowest_price": "31.12" , "item_deal": "38435" , "item_volumn": "12107.12" , "item_change": "1.87" },{"item_start_time": "2016/7/18 0:00:00", "item_end_time": "2016/7/18 0:00:00", "item_start_price": "31.6", "item_end_price": "31.57" , "item_highest_price": "31.99" , "item_lowest_price": "31.2" , "item_deal": "28599" , "item_volumn": "9016.63" , "item_change": "1.39" },{"item_start_time": "2016/7/19 0:00:00", "item_end_time": "2016/7/19 0:00:00", "item_start_price": "31.58", "item_end_price": "31.83" , "item_highest_price": "31.94" , "item_lowest_price": "31.3" , "item_deal": "39243" , "item_volumn": "12476.24" , "item_change": "1.91" },{"item_start_time": "2016/7/20 0:00:00", "item_end_time": "2016/7/20 0:00:00", "item_start_price": "32", "item_end_price": "31.3" , "item_highest_price": "32.14" , "item_lowest_price": "31.2" , "item_deal": "45349" , "item_volumn": "14284.08" , "item_change": "2.2" },{"item_start_time": "2016/7/21 0:00:00", "item_end_time": "2016/7/21 0:00:00", "item_start_price": "31.21", "item_end_price": "31.02" , "item_highest_price": "31.52" , "item_lowest_price": "31" , "item_deal": "40105" , "item_volumn": "12509.07" , "item_change": "1.95" },{"item_start_time": "2016/7/22 0:00:00", "item_end_time": "2016/7/22 0:00:00", "item_start_price": "30.9", "item_end_price": "31.1" , "item_highest_price": "31.25" , "item_lowest_price": "30.7" , "item_deal": "33341" , "item_volumn": "10322.75" , "item_change": "1.62" },{"item_start_time": "2016/7/25 0:00:00", "item_end_time": "2016/7/25 0:00:00", "item_start_price": "31.08", "item_end_price": "30.81" , "item_highest_price": "31.29" , "item_lowest_price": "30.6" , "item_deal": "24255" , "item_volumn": "7500.41" , "item_change": "1.18" },{"item_start_time": "2016/7/26 0:00:00", "item_end_time": "2016/7/26 0:00:00", "item_start_price": "30.61", "item_end_price": "30.74" , "item_highest_price": "30.95" , "item_lowest_price": "30.61" , "item_deal": "25725" , "item_volumn": "7917.65" , "item_change": "1.25" },{"item_start_time": "2016/7/27 0:00:00", "item_end_time": "2016/7/27 0:00:00", "item_start_price": "30.79", "item_end_price": "29.19" , "item_highest_price": "31.14" , "item_lowest_price": "28" , "item_deal": "75593" , "item_volumn": "22187.45" , "item_change": "3.67" },{"item_start_time": "2016/7/28 0:00:00", "item_end_time": "2016/7/28 0:00:00", "item_start_price": "28.8", "item_end_price": "28.26" , "item_highest_price": "28.99" , "item_lowest_price": "27.3" , "item_deal": "50075" , "item_volumn": "14096.95" , "item_change": "2.43" },{"item_start_time": "2016/7/29 0:00:00", "item_end_time": "2016/7/29 0:00:00", "item_start_price": "28.12", "item_end_price": "27.77" , "item_highest_price": "28.43" , "item_lowest_price": "27.6" , "item_deal": "23831" , "item_volumn": "6654.42" , "item_change": "1.16" },{"item_start_time": "2016/8/1 0:00:00", "item_end_time": "2016/8/1 0:00:00", "item_start_price": "27.09", "item_end_price": "27.5" , "item_highest_price": "27.98" , "item_lowest_price": "26.26" , "item_deal": "33768" , "item_volumn": "9116.08" , "item_change": "1.64" },{"item_start_time": "2016/8/2 0:00:00", "item_end_time": "2016/8/2 0:00:00", "item_start_price": "27.5", "item_end_price": "27.67" , "item_highest_price": "27.7" , "item_lowest_price": "27.16" , "item_deal": "16015" , "item_volumn": "4416.4" , "item_change": "0.78" },{"item_start_time": "2016/8/3 0:00:00", "item_end_time": "2016/8/3 0:00:00", "item_start_price": "27.74", "item_end_price": "27.58" , "item_highest_price": "27.95" , "item_lowest_price": "27.5" , "item_deal": "15785" , "item_volumn": "4370.43" , "item_change": "0.77" },{"item_start_time": "2016/8/4 0:00:00", "item_end_time": "2016/8/4 0:00:00", "item_start_price": "27.58", "item_end_price": "28.03" , "item_highest_price": "28.28" , "item_lowest_price": "27.36" , "item_deal": "28805" , "item_volumn": "8031.21" , "item_change": "1.4" },{"item_start_time": "2016/8/5 0:00:00", "item_end_time": "2016/8/5 0:00:00", "item_start_price": "28.02", "item_end_price": "27.6" , "item_highest_price": "28.05" , "item_lowest_price": "27.57" , "item_deal": "21283" , "item_volumn": "5894.06" , "item_change": "1.03" },{"item_start_time": "2016/8/8 0:00:00", "item_end_time": "2016/8/8 0:00:00", "item_start_price": "27.6", "item_end_price": "27.44" , "item_highest_price": "27.6" , "item_lowest_price": "26.85" , "item_deal": "23561" , "item_volumn": "6409.89" , "item_change": "1.14" },{"item_start_time": "2016/8/9 0:00:00", "item_end_time": "2016/8/9 0:00:00", "item_start_price": "27.5", "item_end_price": "27.63" , "item_highest_price": "27.8" , "item_lowest_price": "27.25" , "item_deal": "25008" , "item_volumn": "6879.64" , "item_change": "1.21" },{"item_start_time": "2016/8/10 0:00:00", "item_end_time": "2016/8/10 0:00:00", "item_start_price": "27.83", "item_end_price": "28.31" , "item_highest_price": "28.8" , "item_lowest_price": "27.66" , "item_deal": "46811" , "item_volumn": "13256.06" , "item_change": "2.27" },{"item_start_time": "2016/8/11 0:00:00", "item_end_time": "2016/8/11 0:00:00", "item_start_price": "28.37", "item_end_price": "27.88" , "item_highest_price": "28.58" , "item_lowest_price": "27.88" , "item_deal": "24824" , "item_volumn": "6990.38" , "item_change": "1.21" },{"item_start_time": "2016/8/12 0:00:00", "item_end_time": "2016/8/12 0:00:00", "item_start_price": "27.8", "item_end_price": "28.03" , "item_highest_price": "28.21" , "item_lowest_price": "27.76" , "item_deal": "15426" , "item_volumn": "4317.58" , "item_change": "0.75" },{"item_start_time": "2016/8/15 0:00:00", "item_end_time": "2016/8/15 0:00:00", "item_start_price": "28.1", "item_end_price": "28.72" , "item_highest_price": "28.88" , "item_lowest_price": "27.9" , "item_deal": "38212" , "item_volumn": "10912.88" , "item_change": "1.86" },{"item_start_time": "2016/8/16 0:00:00", "item_end_time": "2016/8/16 0:00:00", "item_start_price": "28.72", "item_end_price": "29.49" , "item_highest_price": "29.96" , "item_lowest_price": "28.72" , "item_deal": "52346" , "item_volumn": "15463.5" , "item_change": "2.54" },{"item_start_time": "2016/8/17 0:00:00", "item_end_time": "2016/8/17 0:00:00", "item_start_price": "29.69", "item_end_price": "29.14" , "item_highest_price": "29.75" , "item_lowest_price": "29" , "item_deal": "27868" , "item_volumn": "8148.89" , "item_change": "1.35" },{"item_start_time": "2016/8/18 0:00:00", "item_end_time": "2016/8/18 0:00:00", "item_start_price": "29.14", "item_end_price": "28.65" , "item_highest_price": "29.19" , "item_lowest_price": "28.6" , "item_deal": "25354" , "item_volumn": "7314.25" , "item_change": "1.23" },{"item_start_time": "2016/8/19 0:00:00", "item_end_time": "2016/8/19 0:00:00", "item_start_price": "28.65", "item_end_price": "29.17" , "item_highest_price": "29.29" , "item_lowest_price": "28.65" , "item_deal": "27786" , "item_volumn": "8069.57" , "item_change": "1.35" },{"item_start_time": "2016/8/22 0:00:00", "item_end_time": "2016/8/22 0:00:00", "item_start_price": "29.4", "item_end_price": "29.85" , "item_highest_price": "30.2" , "item_lowest_price": "29.27" , "item_deal": "49658" , "item_volumn": "14843.96" , "item_change": "2.41" },{"item_start_time": "2016/8/23 0:00:00", "item_end_time": "2016/8/23 0:00:00", "item_start_price": "29.85", "item_end_price": "29.1" , "item_highest_price": "29.99" , "item_lowest_price": "29.07" , "item_deal": "30484" , "item_volumn": "8982.87" , "item_change": "1.48" },{"item_start_time": "2016/8/24 0:00:00", "item_end_time": "2016/8/24 0:00:00", "item_start_price": "29.1", "item_end_price": "28.75" , "item_highest_price": "29.19" , "item_lowest_price": "28.59" , "item_deal": "30711" , "item_volumn": "8845.66" , "item_change": "1.49" },{"item_start_time": "2016/8/25 0:00:00", "item_end_time": "2016/8/25 0:00:00", "item_start_price": "28.7", "item_end_price": "28.37" , "item_highest_price": "28.7" , "item_lowest_price": "28.15" , "item_deal": "17425" , "item_volumn": "4936.57" , "item_change": "0.85" },{"item_start_time": "2016/8/26 0:00:00", "item_end_time": "2016/8/26 0:00:00", "item_start_price": "28.57", "item_end_price": "28.51" , "item_highest_price": "28.86" , "item_lowest_price": "28.4" , "item_deal": "13973" , "item_volumn": "4000.18" , "item_change": "0.68" },{"item_start_time": "2016/8/29 0:00:00", "item_end_time": "2016/8/29 0:00:00", "item_start_price": "28.8", "item_end_price": "28.32" , "item_highest_price": "28.98" , "item_lowest_price": "28.02" , "item_deal": "21694" , "item_volumn": "6172.02" , "item_change": "1.04" },{"item_start_time": "2016/8/30 0:00:00", "item_end_time": "2016/8/30 0:00:00", "item_start_price": "28.58", "item_end_price": "28.45" , "item_highest_price": "28.67" , "item_lowest_price": "28.08" , "item_deal": "12801" , "item_volumn": "3632.45" , "item_change": "0.61" },{"item_start_time": "2016/8/31 0:00:00", "item_end_time": "2016/8/31 0:00:00", "item_start_price": "28.7", "item_end_price": "28.28" , "item_highest_price": "28.7" , "item_lowest_price": "28.04" , "item_deal": "24717" , "item_volumn": "6976.19" , "item_change": "1.19" },{"item_start_time": "2016/9/1 0:00:00", "item_end_time": "2016/9/1 0:00:00", "item_start_price": "28.2", "item_end_price": "28.12" , "item_highest_price": "28.36" , "item_lowest_price": "27.88" , "item_deal": "19958" , "item_volumn": "5614.53" , "item_change": "0.96" },{"item_start_time": "2016/9/2 0:00:00", "item_end_time": "2016/9/2 0:00:00", "item_start_price": "28.1", "item_end_price": "28.3" , "item_highest_price": "28.46" , "item_lowest_price": "27.87" , "item_deal": "18244" , "item_volumn": "5135.88" , "item_change": "0.87" },{"item_start_time": "2016/9/5 0:00:00", "item_end_time": "2016/9/5 0:00:00", "item_start_price": "28.33", "item_end_price": "28.9" , "item_highest_price": "29.14" , "item_lowest_price": "28.33" , "item_deal": "38292" , "item_volumn": "11080.72" , "item_change": "1.84" },{"item_start_time": "2016/9/6 0:00:00", "item_end_time": "2016/9/6 0:00:00", "item_start_price": "28.99", "item_end_price": "29.68" , "item_highest_price": "29.69" , "item_lowest_price": "28.72" , "item_deal": "53670" , "item_volumn": "15736.78" , "item_change": "2.57" },{"item_start_time": "2016/9/7 0:00:00", "item_end_time": "2016/9/7 0:00:00", "item_start_price": "29.68", "item_end_price": "29.14" , "item_highest_price": "29.83" , "item_lowest_price": "29.08" , "item_deal": "31392" , "item_volumn": "9232.86" , "item_change": "1.51" },{"item_start_time": "2016/9/8 0:00:00", "item_end_time": "2016/9/8 0:00:00", "item_start_price": "29", "item_end_price": "29" , "item_highest_price": "29.29" , "item_lowest_price": "28.84" , "item_deal": "17820" , "item_volumn": "5170.83" , "item_change": "0.85" },{"item_start_time": "2016/9/9 0:00:00", "item_end_time": "2016/9/9 0:00:00", "item_start_price": "28.98", "item_end_price": "28.82" , "item_highest_price": "29.29" , "item_lowest_price": "28.8" , "item_deal": "18556" , "item_volumn": "5393.64" , "item_change": "0.89" },{"item_start_time": "2016/9/12 0:00:00", "item_end_time": "2016/9/12 0:00:00", "item_start_price": "28.3", "item_end_price": "27.96" , "item_highest_price": "28.67" , "item_lowest_price": "27.8" , "item_deal": "24288" , "item_volumn": "6844.21" , "item_change": "1.16" },{"item_start_time": "2016/9/14 0:00:00", "item_end_time": "2016/9/14 0:00:00", "item_start_price": "28.4", "item_end_price": "29.72" , "item_highest_price": "30.5" , "item_lowest_price": "28.2" , "item_deal": "59328" , "item_volumn": "17487.57" , "item_change": "2.84" },{"item_start_time": "2016/9/19 0:00:00", "item_end_time": "2016/9/19 0:00:00", "item_start_price": "29.71", "item_end_price": "29.6" , "item_highest_price": "30.45" , "item_lowest_price": "29.08" , "item_deal": "38107" , "item_volumn": "11283.67" , "item_change": "1.83" },{"item_start_time": "2016/9/20 0:00:00", "item_end_time": "2016/9/20 0:00:00", "item_start_price": "29.5", "item_end_price": "29.43" , "item_highest_price": "29.95" , "item_lowest_price": "29.3" , "item_deal": "21251" , "item_volumn": "6264.72" , "item_change": "1.02" },{"item_start_time": "2016/9/21 0:00:00", "item_end_time": "2016/9/21 0:00:00", "item_start_price": "29.43", "item_end_price": "29.08" , "item_highest_price": "29.55" , "item_lowest_price": "29" , "item_deal": "18279" , "item_volumn": "5347.38" , "item_change": "0.88" },{"item_start_time": "2016/9/22 0:00:00", "item_end_time": "2016/9/22 0:00:00", "item_start_price": "29.19", "item_end_price": "29.4" , "item_highest_price": "29.78" , "item_lowest_price": "29.19" , "item_deal": "27159" , "item_volumn": "8020.77" , "item_change": "1.3" },{"item_start_time": "2016/9/23 0:00:00", "item_end_time": "2016/9/23 0:00:00", "item_start_price": "29.34", "item_end_price": "29.51" , "item_highest_price": "29.74" , "item_lowest_price": "29.07" , "item_deal": "22073" , "item_volumn": "6500.36" , "item_change": "1.06" },{"item_start_time": "2016/9/26 0:00:00", "item_end_time": "2016/9/26 0:00:00", "item_start_price": "29.53", "item_end_price": "28.66" , "item_highest_price": "29.6" , "item_lowest_price": "28.54" , "item_deal": "22038" , "item_volumn": "6430.57" , "item_change": "1.06" },{"item_start_time": "2016/9/27 0:00:00", "item_end_time": "2016/9/27 0:00:00", "item_start_price": "28.36", "item_end_price": "28.69" , "item_highest_price": "28.91" , "item_lowest_price": "28.21" , "item_deal": "17510" , "item_volumn": "4992.51" , "item_change": "0.84" },{"item_start_time": "2016/9/28 0:00:00", "item_end_time": "2016/9/28 0:00:00", "item_start_price": "28.71", "item_end_price": "28.98" , "item_highest_price": "28.98" , "item_lowest_price": "28.53" , "item_deal": "20058" , "item_volumn": "5767.04" , "item_change": "0.96" },{"item_start_time": "2016/9/29 0:00:00", "item_end_time": "2016/9/29 0:00:00", "item_start_price": "28.9", "item_end_price": "29.05" , "item_highest_price": "29.33" , "item_lowest_price": "28.83" , "item_deal": "18673" , "item_volumn": "5432.69" , "item_change": "0.9" },{"item_start_time": "2016/9/30 0:00:00", "item_end_time": "2016/9/30 0:00:00", "item_start_price": "29.05", "item_end_price": "29.22" , "item_highest_price": "29.29" , "item_lowest_price": "28.95" , "item_deal": "15813" , "item_volumn": "4601.2" , "item_change": "0.76" }] }';
    var stock_data = eval('(' + stock_data_json + ')');
    var svg = document.getElementById("svg");
    var min_k_line_width = 5;
    var k_line_width = min_k_line_width;
    var k_line_map_width = 0;
    var k_line_map_height = 0;
    var k_line_map_x = 0;
    var k_line_map_y = 0;
    var stock_data_start_index = 0;
    var stock_data_end_index = 0;
    var k_line_max_count_in_map = 0;
    var k_line_count_in_map = 0;
    var stock_max_price = 0;
    var stock_min_price = 0;
    var svg_width = window.innerWidth-25;
    var svg_height = window.innerHeight-50;
    var draw_state = false;
    function ready_draw() {
        hide_high_light_point_1();
        var btn_draw = document.getElementById("btn_draw");
        if (!draw_state) {
            btn_draw.style.backgroundColor = "blue";
        }
        else
        {
            btn_draw.style.backgroundColor = "white";
        }
        draw_state = !draw_state;
    }
    function init() {
        svg.innerHTML = "";
        //-25是为了保证svg图不出窗口，不出现滚动条。
        svg.style.width = svg_width;
        svg.style.height = svg_height;
        //设定K线图本身的宽和高，缩进的地方是留白，填写坐标用。
        k_line_map_width = svg_width - 150;
        k_line_map_height = svg_height - 50;

        k_line_max_count_in_map = parseInt(k_line_map_width / min_k_line_width) - 1;
        if (stock_data.items.length > k_line_max_count_in_map)
        {
            k_line_count_in_map = k_line_max_count_in_map;
        }
        else{
            k_line_count_in_map = stock_data.items.length;
        }
        stock_data_end_index = stock_data.items.length - 1;
        stock_data_start_index = stock_data_end_index + 1 - k_line_count_in_map;
        k_line_width = parseInt(min_k_line_width * (k_line_max_count_in_map / k_line_count_in_map));
        //K线图在整个SVG图当中的位置，当然k线图的宽高，都要小于SVG的宽高，缩进的地方是留白，填写坐标用。
        k_line_map_x = parseInt(k_line_width/2);
        k_line_map_y = 25;
        stock_max_price = get_max_price(stock_data.items, stock_data_start_index, stock_data_end_index);
        stock_min_price = get_min_price(stock_data.items, stock_data_start_index, stock_data_end_index)
        var line_min = createLine("line_min", 0, get_y_value(stock_min_price),
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2), get_y_value(stock_min_price),
            "1px", "rgb(255,0,0)", "2,2");
        //line_min.setAttributeNS(xmlns,"stroke-dasharray", "2,2");
        svg.appendChild(line_min);
        var text_min = createTextBox("txt_min", k_line_map_width + k_line_map_x + parseInt(k_line_width/2) + 10,
            get_y_value(stock_min_price),  stock_min_price.toString(), "15", "rgb(255,0,0)");
        svg.appendChild(text_min);
        var line_191 = createLine("line_191", 0, get_y_value((stock_max_price - stock_min_price) * 0.191 + stock_min_price),
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2), get_y_value((stock_max_price - stock_min_price) * 0.191+ stock_min_price),
            "1px", "rgb(255,0,0)", "2,15");
        svg.appendChild(line_191);
        var text_191 = createTextBox("txt_191",
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2) + 10, get_y_value((stock_max_price - stock_min_price) * 0.191+ stock_min_price),
            "19.1% " + (Math.round(((stock_max_price - stock_min_price) * 0.191+ stock_min_price)*100)/100).toString(), "15", "rgb(255,0,0)");
        svg.appendChild(text_191);
        var line_382 = createLine("line_382", 0, get_y_value((stock_max_price - stock_min_price) * 0.382+stock_min_price),
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2), get_y_value((stock_max_price - stock_min_price) * 0.382+ stock_min_price),
            "1px", "rgb(255,0,0)", "2,15");
        svg.appendChild(line_382);
        var text_382 = createTextBox("txt_382",
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2) + 10, get_y_value((stock_max_price - stock_min_price) * 0.382+ stock_min_price),
            "38.2% " + (Math.round(((stock_max_price - stock_min_price) * 0.382+ stock_min_price)*100)/100).toString(), "15", "rgb(255,0,0)");
        svg.appendChild(text_382);
        var line_half = createLine("line_half", 0, get_y_value((stock_max_price - stock_min_price) * 0.5+stock_min_price),
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2), get_y_value((stock_max_price - stock_min_price) * 0.5+ stock_min_price),
            "1px", "rgb(255,0,0)", "2,15");
        svg.appendChild(line_half);
        var text_50 = createTextBox("txt_50",
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2) + 10, get_y_value((stock_max_price - stock_min_price) * 0.50+ stock_min_price),
            "50% " + (Math.round(((stock_max_price - stock_min_price) * 0.50+ stock_min_price)*100)/100).toString(), "15", "rgb(255,0,0)");
        svg.appendChild(text_50);
        var line_618 = createLine("line_618", 0, get_y_value((stock_max_price - stock_min_price) * 0.618+stock_min_price),
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2), get_y_value((stock_max_price - stock_min_price) * 0.618+ stock_min_price),
            "1px", "rgb(255,0,0)", "2,15");
        svg.appendChild(line_618);
        var text_618 = createTextBox("txt_618",
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2)+10, get_y_value((stock_max_price - stock_min_price) * 0.618+ stock_min_price),
            "61.8% " + (Math.round(((stock_max_price - stock_min_price) * 0.618+ stock_min_price)*100)/100).toString(), "15", "rgb(255,0,0)");
        svg.appendChild(text_618);
        var line_809 = createLine("line_809", 0, get_y_value((stock_max_price - stock_min_price) * 0.809+stock_min_price),
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2), get_y_value((stock_max_price - stock_min_price) * 0.809+ stock_min_price),
            "1px", "rgb(255,0,0)", "2,15");
        svg.appendChild(line_809);
        var text_809 = createTextBox("txt_809",
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2) + 10, get_y_value((stock_max_price - stock_min_price) * 0.809+ stock_min_price),
            "80.9% " + (Math.round(((stock_max_price - stock_min_price) * 0.809+ stock_min_price)*100)/100).toString(), "15", "rgb(255,0,0)");
        svg.appendChild(text_809);
        var line_max = createLine("line_max", 0, get_y_value(stock_max_price),
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2), get_y_value(stock_max_price),
            "1px", "rgb(255,0,0)", "2,2");
        svg.appendChild(line_max);
        var text_max = createTextBox("txt_max",
            k_line_map_width + k_line_map_x + parseInt(k_line_width/2) + 10, get_y_value((stock_max_price - stock_min_price) + stock_min_price),
            (Math.round(((stock_max_price - stock_min_price) + stock_min_price)*100)/100).toString(), "15", "rgb(255,0,0)");
        svg.appendChild(text_max);
        for(var i = stock_data_end_index; i >= stock_data_start_index && i >=0 ; i--) {
            draw_k_line(i, stock_data.items[i].item_start_price, stock_data.items[i].item_end_price,
                stock_data.items[i].item_highest_price, stock_data.items[i].item_lowest_price);
        }

        //var poly_line = createPolyLine("poly_line", "0,0 100,100 200,200 300,300", "1", "green");
        //svg.appendChild(poly_line);
        draw_3_3_line();
    }
    function draw_3_3_line() {
        var points_array = "";
        var prev_x = -1;
        var prev_y = -1;
        for(i = stock_data_end_index; i >= stock_data_start_index; i--) {
            if (i - 6 >= 0 ) {
                var x = get_x_value(i);
                var avg_price = (parseFloat(stock_data.items[i-5].item_end_price) +  parseFloat(stock_data.items[i-4].item_end_price)
                    + parseFloat(stock_data.items[i-3].item_end_price))/3;
                if (prev_x != -1 && prev_y != -1 ) {
                    var line_3_3 = createLine("line_3_3_" + i.toString(), prev_x, prev_y, x, get_y_value(avg_price), "1", "green");
                    svg.appendChild(line_3_3);
                }
                prev_x = x;
                prev_y = get_y_value(avg_price);
            }
        }
    }
    function get_y_value(price) {
        return parseInt(k_line_map_y + k_line_map_height * (stock_max_price - price)/(stock_max_price - stock_min_price));
    }
    function get_price(y) {
        var max_y = get_y_value(stock_max_price);
        var min_y = get_y_value(stock_min_price);
        if (min_y >= y && max_y <= y) {
            var price = stock_min_price + (stock_max_price-stock_min_price) * (y - min_y)/(max_y - min_y);
            return price;
        }
        else {
            return 0;
        }
    }
    function get_x_value(item_index) {
        var x_val = k_line_map_x + (item_index - stock_data_start_index) * k_line_width;
        return parseInt(x_val);

    }
    function get_item_index(x) {
        var idx = (x/k_line_width) + stock_data_start_index - k_line_map_x;
        return Math.min(parseInt(idx), stock_data_end_index);
    }
    function draw_k_line(item_index, start_price, end_price, highest_price, lowest_price) {
        var k_line_color = "rgb(255,0,0)";
        if (end_price < start_price) {
            color = "rgb(0,255,0)";
        }
        else if (end_price == start_price ) {
            color = "rgb(100,100,100)";
        }
        else {
            color = "rgb(255,0,0)";
        }
        var x = get_x_value(item_index);
        var upper_limit = Math.max(start_price, end_price);
        var lower_limit = Math.min(start_price, end_price);

        if (highest_price > upper_limit) {
            var upper_shaddow_line = createLine("shaddow_upper_" + item_index.toString(), x, get_y_value(highest_price), x, get_y_value(upper_limit), "1px", color);
            upper_shaddow_line.setAttributeNS(xmlns, "name", "k_line_upper");
            svg.appendChild(upper_shaddow_line);
        }
        if (upper_limit == lower_limit){
            var k_line = createLine("k_" + item_index.toString(), x, get_y_value(upper_limit)-1, x, get_y_value(lower_limit)+1,
                (k_line_width-1).toString() + "px", color);
            k_line.setAttributeNS(xmlns, "name", "k_line");
            svg.appendChild(k_line);
        }
        else {
            var k_line = createLine("k_" + item_index.toString(), x, get_y_value(upper_limit), x, get_y_value(lower_limit),
                (k_line_width-1).toString() + "px", color);
            k_line.setAttributeNS(xmlns, "name", "k_line");
            svg.appendChild(k_line);
        }
        if (lowest_price < lower_limit) {
            var lower_shaddow_line = createLine("shaddow_lower_" + item_index, x, get_y_value(lower_limit), x, get_y_value(lowest_price), "1px", color);
            lower_shaddow_line.setAttributeNS(xmlns, "name", "k_line_lower");
            svg.appendChild(lower_shaddow_line);
        }
    }
    function mouse_move(evt) {
        show_price_date(evt);
        if (draw_state){
            draw_gold_line(evt);
        }
    }
    function show_hide_box(evt) {
        alert(evt);
    }
    function mouse_down(evt) {
        if (draw_state) {
            if (gold_line_current_high_light_position=="min") {
                gold_line_min_idx = gold_line_current_idx;
                gold_line_min_price = stock_data.items[gold_line_min_idx].item_lowest_price;
            }
            else if (gold_line_current_high_light_position=="max"){
                gold_line_max_idx = gold_line_current_idx;
                gold_line_max_price = stock_data.items[gold_line_max_idx].item_highest_price;
            }
        }
    }
    function mouse_up(evt) {
        if (draw_state) {

            if (gold_line_max_idx == -1) {
                gold_line_max_idx = gold_line_another_idx;
            }
            if (gold_line_min_idx == -1){
                gold_line_min_idx = gold_line_another_idx;
            }
            hide_gold_line();
            if (gold_line_min_idx != gold_line_another_idx || gold_line_max_idx != gold_line_another_idx) {
                display_gold_line_between_prices(stock_data.items[gold_line_min_idx].item_lowest_price,
                    stock_data.items[gold_line_max_idx].item_highest_price);
            }
            hide_high_light_point_1();
            hide_high_light_point_2();
            draw_state = false;
            gold_line_another_idx = -1;
            gold_line_max_idx = -1;
            gold_line_min_idx = -1;
            var btn_draw = document.getElementById("btn_draw");
            btn_draw.style.backgroundColor = "white";
        }
    }
</script>
</html>